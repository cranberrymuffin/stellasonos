(()=>{var t={343:t=>{t.exports=function(){"use strict";var t=(2,12,Math.pow(2,1/12)),e=7902.13,a={};function i(t){return"string"==typeof t&&/^[A-G][b#]?[0-8]$/.test(t)}function s(t){return a.hasOwnProperty(t)}function n(t){return"string"==typeof t&&/^[A-Za-z\-\_ ]+$/.test(t)}function r(t){return Array.isArray(t)&&t.every(h)}function h(t){return"number"==typeof t&&t%1==0&&t>0}function o(a,i){var s=a*Math.pow(t,i);return s=(s=s>e?e:s)<16.35?16.35:s,Math.round(100*s)/100}function c(t){return 100*t}function l(t,e){return{C:-9,D:-7,E:-5,F:-4,G:-2,A:0,B:2}[t]+12*(e-4)}function d(t){return"#"!==t&&"b"!==t?0:{"#":1,b:-1}[t]}function g(t){if(!i(t))throw new Error('Invalid argument noteString: getNote(noteString) noteString should be a valid note name, eg. "Ab0", "C7"');var e=t.match(/^[A-G]/g),a=t.match(/[b#]/g),s=t.match(/[0-8]/g),n=e?e[0]:null,r=a?a[0]:null;return o(440,l(n,s?parseInt(s[0],10):null)+d(r))}return a.chromatic=[1],a.wholeTone=[2],a.major=[2,2,1,2,2,2,1],a.majorPentatonic=[2,2,3,2,3],a.minorPentatonic=[3,2,2,3,2],a.kuomiPentatonic=[1,4,2,1,4],a.chinesePentatonic=[4,2,1,4,1],a.naturalMinor=[2,1,2,2,1,2,2],a.harmonicMinor=[2,1,2,2,1,3,1],a.melodicMinor=[2,1,2,2,2,2,1],{makeScale:function(t,e,r){if(arguments.length<3)throw new Error("Missing argument(s): makeScale() expects three arguments");if(!n(t))throw new Error("Invalid argument scaleType: makeScale(scaleType, startNote, noteCount) expects scaleType to be a string consisting of lower or upper case letters (A-Z, a-z), spaces, hyphens(-) or underscores(_) only");if(!s(t))throw new Error("Scale type is undefined: makeScale(scaleType, startNote, noteCount) scale with name provided for scaleType is not defined – make sure you choose from available scale types");if(!h(r))throw new Error("Invalid argument noteCount: makeScale(scaleType, startNote, noteCount) expects noteCount to be a positive integer greater than 0");if(!i(e))throw new Error('Invalid argument startNote: makeScale(scaleType, startNote, noteCount) startNote should be a valid note name, eg. "Ab0", "C7"');var l,d=a[t],u=[],m=[],v=[],f=0,p=0,w=g(e);for(u.push(w),m.push(0),v.push(0),l=0;l<r-1;l+=1)f+=d[p],u.push(o(w,f)),m.push(c(f)),v.push(f),p=p===d.length-1?0:p+1;return{startNote:w,inHertz:u,inCents:m,inSemiTones:v}},getNote:g,addScale:function(t,e){if(arguments.length<2)throw new Error("Missing argument(s): addScale() expects two arguments");if(!n(t))throw new Error("Invalid argument name: addScale(name, scaleDef) expects name to be a string consisting of lower or upper case letters (A-Z, a-z), spaces, hyphens(-) or underscores(_) only");if(s(t))throw new Error("Scale type already defined: addScale(name, scaleDef) scale with value of name argument is already defined – make sure you choose a scale name not already in use");if(!r(e))throw new Error("Invalid argument scaleDef: addScale(name, scaleDef) expects scaleDef to be an array of only positive integers greater than 0");a[t]=e},getScaleNames:function(){var t,e=[];for(t in a)a.hasOwnProperty(t)&&e.push(t);return e},test:{getIntervalFromA4:l,getIntervalAdjustment:d,getCentsByInterval:c,getNoteByInterval:o,isValidNoteName:i,isValidScaleName:n,isValidScaleDefinition:r,isPositiveIntegerGreaterThanZero:h,isScaleTypeDefined:s}}}()}},e={};function a(i){if(e[i])return e[i].exports;var s=e[i]={exports:{}};return t[i](s,s.exports,a),s.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t{constructor(t,e,a){this.frequencies=t,this.ctx=a,this.oscillators=[],this.compressor=e,this.initOscillators(t)}playNote(t,e){var a=this.ctx.createOscillator();a.type="sine",a.frequency.value=this.frequencies[this.frequencies.length-1-t];var i=this.ctx.createGain();i.connect(this.compressor),i.gain.value=0,a.connect(i),i.gain.linearRampToValueAtTime(e,this.ctx.currentTime+.1),i.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.8),a.start(),a.stop(this.ctx.currentTime+.8)}initOscillators(t){for(var e=0;e<t.length;e++){var a=this.ctx.createOscillator();a.type="sine";var i=this.ctx.createGain();i.connect(this.compressor),i.gain.value=0,a.connect(i),a.frequency.value=t[t.length-1-e],a.start(this.ctx.currentTime),this.oscillators[e]={osc:a,gain:i,val:0}}}updateGains(t){for(var e=0;e<t.length;e++)this.oscillators[e].val!=t[e]&&(this.oscillators[e].val=t[e],this.oscillators[e].gain.gain.cancelScheduledValues(this.ctx.currentTime),this.oscillators[e].gain.gain.linearRampToValueAtTime(t[e],this.ctx.currentTime+.1))}endSynth(){for(var t=0;t<this.oscillators.length;t++)this.oscillators[t].gain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.8),this.oscillators[t].osc.stop(this.ctx.currentTime+.8)}}var e,i,s,n=a(343),r=a.n(n);class h{constructor(t,e){this.canvas=document.createElement("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style.position="fixed",this.canvas.style.top="0px",this.canvas.style.left="0px",this.settings=t,this.handlePlay=e,this.filterCanvas=document.createElement("canvas"),this.filterCanvas.width=window.innerWidth,this.filterCanvas.height=window.innerHeight,this.filterCtx=this.filterCanvas.getContext("2d"),this.ctx=this.canvas.getContext("2d"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),document.body.appendChild(this.canvas),this.loadImage("./images/nightsky.jpg")}clearImage(){this.ctx.globalCompositeOperation="source-over",this.filterCtx.fillStyle="rgb(0, 0, 0)",this.filterCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgb(0, 0, 0)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.data=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.imageData=this.data.data,this.originalData=[];for(var t=0;t<this.data.data.length;t++)this.originalData[t]=this.data.data[t]}loadImage(t){var e=new Image;e.src=t,e.onload=function(){this.filterCtx.drawImage(e,0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgb(0, 0, 0)",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.filterCanvas,0,0,this.canvas.width,this.canvas.height),this.toGrayscale(),this.settings.play&&this.handlePlay()}.bind(this),this.img=e}resize(t,e){this.canvas.width=t,this.canvas.height=e,this.filterCanvas.width=t,this.filterCanvas.height=e,this.filterCtx.drawImage(this.img,0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.filterCanvas,0,0,this.canvas.width,this.canvas.height),this.toGrayscale()}toGrayscale(){this.data=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);for(var t=this.data.data,e=0;e<t.length;e+=4){var a=.299*t[e]+.587*t[e+1]+.114*t[e+2];t[e]=a,t[e+1]=a,t[e+2]=a}for(this.ctx.putImageData(this.data,0,0),this.filterCtx.putImageData(this.data,0,0),this.imageData=t,this.originalData=[],e=0;e<t.length;e++)this.originalData[e]=t[e];this.settings.invert?this.invert():this.calculatePixels()}drawRepetitions(){var t=this.settings.rotation*Math.PI*2,e=this.canvas.width/(1+5*this.settings.repetitions.x),a=this.canvas.height/(1+5*this.settings.repetitions.y),i=(3*this.settings.spacing.x+.5)*e,s=(3*this.settings.spacing.y+.5)*a,n=this.canvas.width/i,r=this.canvas.height/s,h=document.createElement("canvas");h.width=e,h.height=a;var o=h.getContext("2d");o.translate(e/2,a/2),o.rotate(t),o.drawImage(this.filterCanvas,-e/2,-a/2,e,a),this.ctx.fillStyle="rgb(0, 0, 0)",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="lighter";for(var c=0;c<n+1;c++)for(var l=0;l<r;l++){var d=c*i-this.settings.offset.x*i*l,g=l*s-this.settings.offset.y*s*c;d<=-i&&(d+=this.canvas.width),g<=-s&&(g+=this.canvas.height),this.ctx.drawImage(h,d,g,e,a)}this.data=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.imageData=this.data.data}invert(){for(var t=0;t<this.imageData.length;t+=4)this.imageData[t]=255-this.originalData[t],this.imageData[t+1]=255-this.originalData[t+1],this.imageData[t+2]=255-this.originalData[t+2];for(this.ctx.putImageData(this.data,0,0),this.filterCtx.putImageData(this.data,0,0),this.originalData=[],t=0;t<this.data.data.length;t++)this.originalData[t]=this.data.data[t];this.calculatePixels()}regenerateImage(){}calculatePixels(){for(var t=255*this.settings.contrast*2-255,e=255*this.settings.brightness*2-255,a=259*(t+255)/(255*(259-t)),i=0;i<this.imageData.length;i+=4)this.imageData[i]=a*(this.originalData[i]+e-128)+128,this.imageData[i+1]=a*(this.originalData[i+1]+e-128)+128,this.imageData[i+2]=a*(this.originalData[i+2]+e-128)+128;this.ctx.putImageData(this.data,0,0),this.filterCtx.putImageData(this.data,0,0),this.drawRepetitions()}}var o,c,l,d,g,u=0,m={brightness:.5,contrast:.5,invert:!1,repetitions:{x:0,y:0},offset:{x:0,y:0},spacing:{x:.16,y:.16},rotation:0,play:!0,speed:.7,drawMode:!0,stroke_width:.1,stroke_repetitions:.3,stroke_opacity:1,eraser:0,stroke_offset:{x:.6,y:.6},scale:{numSteps:100,note:"C",octave:1,type:"chromatic"}},v=0;function f(t,e){var a=(new Date).getTime(),i=Math.max(0,16-(a-v)),s=window.setTimeout((function(){t(a+i)}),i);return v=a+i,s}function p(){s=g.currentTime,m.play=!0,g.resume&&g.resume()}function w(){var t=Math.floor((g.currentTime-s)*(400*m.speed-200)),a=u+t;if(a>=i.canvas.width)for(;a>=i.canvas.width;)a-=i.canvas.width;a<0&&(a+=i.canvas.width),l.clearRect(0,0,c.width,c.height),l.fillStyle="rgba(255, 0, 0, 1)",l.fillRect(a-5,0,10,i.canvas.height),l.fillStyle="rgba(255, 255, 255, 1)";for(var n=[],r=0;r<m.scale.numSteps;r++){var h,o=Math.floor((r+.5)*i.canvas.height/m.scale.numSteps),d=4*(o*i.canvas.width+a);h=(i.imageData[d]+i.imageData[d+1]+i.imageData[d+2])/765,l.fillRect(a-5,o,10,5*h),n[r]=h}e.updateGains(n),s=g.currentTime}function x(t){g.resume(),u=t.pageX,f(w)}function y(t){g.resume(),u=t.pageX,f(w)}function D(){g.resume()}function C(t){g.resume(),t.changedTouches,null!=t.touches&&(u=t.touches[0].pageX,f(w))}function I(){i.resize(window.innerWidth,window.innerHeight),c.width=window.innerWidth,c.height=window.innerHeight}function S(t){g.resume()}function T(t){}function b(t){}window.AudioContext=window.AudioContext||window.webkitAudioContext,window.onload=function(){document.body.removeChild(document.getElementById("landing")),new Array,i=new h(m,p),(c=document.createElement("canvas")).width=window.innerWidth,c.height=window.innerHeight,c.style.position="fixed",c.style.top="0px",c.style.left="0px",l=c.getContext("2d"),g=new window.AudioContext,(d=g.createDynamicsCompressor()).connect(g.destination),o=r().makeScale(m.scale.type,"C3",m.scale.numSteps).inHertz,e=new t(o,d,g),g.resume(),document.body.appendChild(c),c.addEventListener("touchstart",C,!1),c.addEventListener("touchend",T,!1),c.addEventListener("touchcancel",b,!1),c.addEventListener("touchmove",S,!1),c.addEventListener("mousedown",x,!1),c.addEventListener("mousemove",y,!1),c.addEventListener("mouseup",D,!1),c.addEventListener("mouseout",D,!1),c.addEventListener("mouseleave",D,!1),window.addEventListener("resize",I)}})()})();